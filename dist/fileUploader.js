define("fileUploader",["jquery"],function(e,i,t){var r=e("jquery"),n=function(e){return this.settings=e,this.init(e),this};n.prototype={_defaults:{inputClass:"fileUploader-element-invisible",labelClass:"fileUploader-label",Debug:!1,id:"fileUpLoader",uploadUrl:"",picker:"input[type=file]",auto:!0,responseType:"json",acceptType:void 0,data:null,sizeLimit:void 0,widthLimit:void 0,heightLimit:void 0,events:{beforeFileQueued:null,error:null,fileQueued:null,uploadStart:null,uploadAbort:null,uploadProgress:null,uploadComplete:null,uploadSuccess:null,uploadError:null}},_acceptTypeList:{image:/\.(jpg|png|gif)$/i,excel:/\.(xls|xlsx)$/i},_errorList:{101:"文件类型不符合要求",102:"文件大小超出限制",103:"图片尺寸不符合要求"},init:function(e){return r?FileReader&&FormData?(r.extend(this,this._defaults,e),this._createUpLoader(),void this._bindEvents()):(this.error("FileReader&FormData is unavailable,请检查浏览器版本"),!1):(this.error("jquery is undefined,请引入jQuery文件"),!1)},_createUpLoader:function(){var e=this;"string"!=typeof e.picker&&e.picker instanceof jQuery||(e.picker=r(e.picker)),e.picker.is(":file")?e.fileInput=e.picker:e.picker.find(":file").length?e.fileInput=e.picker.find(":file"):(e.fileInput=r('<input type="file"/>'),e.picker.append(e.fileInput));var i=new Date;e.id=e.id+"_"+i.getTime().toString().slice(-4,-1),e.fileInput.attr("id",e.id).addClass(e.inputClass),e.picker.find("label[for="+e.id+"]").length?e.label=e.picker.find("label[for="+e.id+"]"):(e.label=r("<label></label>").attr("for",e.id),e.fileInput.before(e.label)),e.label.addClass(e.labelClass),e.fr=new FileReader,e.xhr=new XMLHttpRequest,e.formatData=new FormData},reset:function(){var e=this;e.destory(),e.fr=new FileReader,e.xhr=new XMLHttpRequest,e.formatData=new FormData,e.fileInput=e.picker.find("input:file"),e.fileInput.attr("id",e.id).addClass(e.inputClass),e._bindEvents()},destory:function(){var e=this;e.fr=null,e.xhr=null,e.formatData=null,e.fileInput.replaceWith('<input type="file"/>')},upload:function(){var e=this;e.xhr.open("POST",e.uploadUrl,!0),e.formatData.append("file",e.file),e.xhr.send(e.formatData)},error:function(e,i){this._errorList[e]?(this._log(this._errorList[e],2),this._executeEvents("error",this.file,{code:e,msg:this._errorList[e]})):(this._log(e,2),this._executeEvents("error",this.file,{code:e,msg:"上传失败"}))},_log:function(e,i){if(!1!==this.Debug)switch(i=i||0){case 0:console.log(e);break;case 1:console.warn(e);break;case 2:console.error(e);break;default:console.log(e)}},_validate:function(e,i,t){var r=this,n=e.name,l=e.size;return r._log("文件名："+n),r._log("上传文件大小："+l),r.acceptType&&r._acceptTypeList[r.acceptType]&&!r._acceptTypeList[r.acceptType].test(n)?(r.error(101),void t(!1)):r.sizeLimit&&r.sizeLimit<l?(r.error(102),void t(!1)):"image"!==r.acceptType||isNaN(r.heightLimit)&&isNaN(r.widthLimit)?void t(!0):void r._checkImage(i,t)},_checkImage:function(e,i){var t=this,r=new Image;r.onload=function(){r.width&&t.widthLimit&&r.width!=t.widthLimit?(t.error(103),i(!1)):r.height&&t.heightLimit&&r.height!=t.heightLimit?(t.error(103),i(!1)):i(!0)},r.src=e},_bindEvents:function(){var e=this;e.label.off("hover").hover(function(){e.picker.find(".fileUploader-pick").addClass("fileUploader-pick-hover")},function(){e.picker.find(".fileUploader-pick").removeClass("fileUploader-pick-hover")}),e.fileInput.off("change").on("change",function(){var i=this.files;1==i.length&&e._fileHandler(i[0])}),e.fr.onload=function(i){e._validate(e.file,this.result,function(i){!1!==e._executeEvents("beforeFileQueued",e.file)&&i?e._executeEvents("fileQueued",e.file,function(i){i?e.auto&&e.upload():e.reset()}):e.reset()})},e.xhr.onreadystatechange=function(i){4==e.xhr.readyState&&200==e.xhr.status&&("json"==e.responseType?e._executeEvents("uploadSuccess",e.file,JSON.parse(e.xhr.responseText)):e._executeEvents("uploadSuccess",e.file,e.xhr.responseText))},e.fr.onabort=function(i){e._executeEvents("uploadError",e.file,i)},e.fr.onerror=function(i){e._executeEvents("uploadError",e.file,i)},e.xhr.upload.onabort=function(i){e._executeEvents("uploadAbort",e.file,i),e._executeEvents("uploadError",e.file,i)},e.xhr.upload.onerror=function(i){e._executeEvents("uploadError",e.file,i)},e.xhr.upload.onload=function(i){e._executeEvents("uploadComplete",e.file,i)},e.xhr.upload.onprogress=function(i){e._executeEvents("uploadProgress",e.file,i)}},_fileHandler:function(e){var i=this;i.file=e,i.fr.readAsDataURL(e)},_executeEvents:function(e,i,t){var r=this;return"function"==typeof r.events[e]?("function"==typeof t&&t(r.events[e](i)),r.events[e](i,t)):("function"==typeof t&&t(!0),!0)}},t.exports=n});